#include <stdlib.h>
#include <sys/types.h>
#include <unistd.h>
#include <wait.h>
#include <stdio.h>
#include <sys/stat.h>
#include <dirent.h>
#include <string.h>

int status;
int main(){
pid_t cid1;
char path[100];
char indomiepath[100];
sprintf(path, 
              "/home/linuxlite/modul2/");


cid1 = fork();

if (cid1 < 0){
  exit(EXIT_FAILURE);
}

if (cid1 == 0){
sprintf(indomiepath, 
              "%s/indomie", path);

char *var[] = {"mkdir", "-p", indomiepath, NULL};
execv("/bin/mkdir", var);
} else {
while ((wait(&status)) > 0);

pid_t cid2;
cid2 = fork();
if (cid2 <  0){
  exit(EXIT_FAILURE);
}

if (cid2 == 0){
sleep(5);
char sedaappath[100];
sprintf(sedaappath, 
              "%s/sedaap", path);
char *var[] = {"mkdir", "-p", sedaappath, NULL};
execv("/bin/mkdir", var);
}else{
  while ((wait(&status)) > 0);
    pid_t cid6;
    cid6 = fork();
    //soal 3b
    if (cid6 < 0){
      exit(EXIT_FAILURE);
    }
    if (cid6== 0){
      char* var[] = {"unzip", "/home/linuxlite/modul2/jpg.zip", NULL};
      execv("/usr/bin/unzip", var);
    } else{
  while ((wait(&status)) > 0);
  char jpgpath[100];
  sprintf(jpgpath, "%sjpg/",path);
  chdir(jpgpath);
  DIR *direct;
  direct = opendir(".");
  struct dirent *dir;
  if(direct){
    while((dir = readdir(direct)) != NULL){
      pid_t cid3;
      struct stat st;
      stat(dir->d_name, &st);
      cid3 = fork();
      if(cid3 < 0){
        exit(EXIT_FAILURE);
      }
      if(cid3 == 0){
        char filepath[100];
        sprintf(filepath,"%s",jpgpath);
 strcat(filepath,dir->d_name);
        if(S_ISDIR(st.st_mode)){
          if(strcmp(dir->d_name, ".") == 0 || strcmp(dir->d_name, "..") == 0);
              else{
                pid_t cid4;
                cid4 = fork();
                if(cid4 < 0){
                  exit(EXIT_FAILURE);
                }
                if(cid4 == 0){
                  char* var[] = {"mv", filepath, indomiepath, NULL};
                  execv("/bin/mv", var);
                }else{
                  while((dir = readdir(direct)) != NULL){
                  pid_t cid5;
                  cid5 = fork();
                  if(cid5 < 0){
                    exit(EXIT_FAILURE);
                  }
                  if(cid5 == 0){
                    char cobapath[100];
                    sprintf(cobapath, "%s",indomiepath);
      strcat(cobapath,dir->d_name);
      strcat(cobapath,"/coba1.txt");
                    char *var[] = {"touch", "-p", cobapath, NULL};
        execv("usr/bin/touch", var);
                  }else{
                    char cobapath[100];
                    sprintf(cobapath, "%s",indomiepath);
      strcat(cobapath,dir->d_name);
      strcat(cobapath,"/coba2.txt");
                    char *var[] = {"touch", "-p", cobapath, NULL};
      execv("usr/bin/touch", var);
                  }
                }
              }
        }
      }else{
        char* var[] = {"mv", filepath, "/home/linuxlite/modul2/sedaap/", NULL};
        execv("/bin/mv", var);
      }
  }
} 
closedir(direct);
}
}
}
}
}
